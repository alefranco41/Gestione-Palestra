{% extends "base.html" %}
{% load custom_filters %}

{% block title %} {{ gym_name }} - Our Schedule {% endblock title %}

{% block header %} Our Schedule {% endblock header %}

{% block content %}
<div style="margin:auto; max-width:800px;">
    <table border="1" style="margin:auto;">
        <tr>
            <th>Day</th>
            {% for hour in hours %}
                <th>{{ hour }}:00</th>
            {% endfor %}
        </tr>
        {% for day, hours_data in schedule.items %}
        <tr>
            <td>{{ day }}</td>
            {% for hour in hours %}
                {% if hour in hours_data.keys %}
                    <td>
                        {% for course in hours_data.values %}
                        <div class="trainer-card">
                            {% if course.image %} <img  src="{{ course.image.url }}" alt="Profile Picture" style="max-width: 200px;">{% endif %}
                            <div class="trainer-details">
                                <p><strong>Trainer:</strong> {{ course.trainer.first_name}} {{ course.trainer.last_name}}</p>
                                <p><strong>Duration:</strong> {{ course.duration }}</p>
                                <p><strong>Description:</strong> {{ course.description }}</p>
                                <p><strong>Max Participants:</strong> {{ course.max_participants }}</p>
                                <p><strong>Remaining Spots:</strong> {{ course.max_participants|subtract:course.total_partecipants }}</p>
                                {% if request.user.is_manager %}
                                 <a href="{%  url 'edit_group_training' course_id=course.id %}">Edit Class</button>
                                {% endif %}
                                <form method="post" class="hidden">{% csrf_token %}<input type="hidden" name="class_id" value="{{ course.id }}"><button type="submit">Join Class</form>
                            </div>
                        </div>
                        {% endfor %}
                    </td>
                {% else %}
                    <td> - </td>
                {% endif %}
            {% endfor %}
        </tr>
        {% endfor %}
    </table>
</div>

<script>
    {% if error %}
        setTimeout(function() {
          alert("{{ error }}");
        }, 100);
      {% endif %}
  </script>
{% endblock %}
